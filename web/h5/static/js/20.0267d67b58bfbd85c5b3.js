webpackJsonp([20],{"13mi":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("Dd8w"),n=a.n(o),r=a("Xxa5"),i=a.n(r),c=(a("eqfM"),a("/QYm")),s=a("exGp"),l=a.n(s),u=a("NyOD"),d=a("1JqO"),p=a("Du/2"),m=a("gyMJ"),g=a("NYxO"),h={mixins:[u.a,d.a],name:"social-wx",created:function(){var e=this;return l()(i.a.mark(function t(){var a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$store.state.token){t.next=9;break}if(1!=localStorage.getItem("first_direct")){t.next=5;break}return e.$router.replace({path:e.$route.query.redirect||"/"}),t.abrupt("return");case 5:return c.a.loading({message:"请稍后"}),e.afterLogin(),localStorage.setItem("first_direct",1),t.abrupt("return");case 9:if(a=localStorage.getItem("socialBinded_wx")?JSON.parse(localStorage.getItem("socialBinded_wx")):e.socialBinded.wx,e.setSocialStatus({key:"wx",status:a}),o=location.search.match(/\?code.*&/g)){t.next=16;break}return localStorage.setItem("first_direct",0),e.wxLogin(),t.abrupt("return");case 16:return c.a.loading({message:"正在登录"}),o=o[0].slice(6,-1),t.next=20,m.a.login({params:{code:o,type:"weixinmob"}}).then(function(t){e.userLogin(t),c.a.clear(),c.a.success({duration:2e3,message:"登录成功"});var a=e.socialBinded.wx?-2:-7;e.$route.query.callbackType&&(a+=1),localStorage.setItem("socialBinded_wx",!0),e.$router.go(a)}).catch(function(e){localStorage.setItem("socialBinded_wx",!1),window.location.href="/login/bind/weixinmob?os=h5&_target_path="+encodeURIComponent(location.pathname+location.hash)});case 20:case"end":return t.stop()}},t,e)}))()},computed:n()({},Object(g.mapState)(["socialBinded"])),methods:n()({},Object(g.mapMutations)({setSocialStatus:p.j,userLogin:p.o}),{wxLogin:function(){c.a.loading({message:"请稍后"});var e=encodeURIComponent(location.origin+location.pathname+location.hash);window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.$route.query.weixinmob_key+"&redirect_uri="+e+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect"}})},x={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]},w=a("VU/8")(h,x,!1,null,null,null);t.default=w.exports}});